-- Autogenerated by migration tool on 2022-01-19 11:28:11

-- Resource: tf.data
CREATE TABLE IF NOT EXISTS "tf_data" (
	"cq_id" uuid NOT NULL,
	"cq_meta" jsonb,
	"cq_fetch_date" timestamp without time zone NOT NULL,
	"backend_type" text,
	"backend_name" text,
	"version" bigint,
	"terraform_version" text,
	"serial" bigint,
	"lineage" text,
	CONSTRAINT tf_data_pk PRIMARY KEY(cq_fetch_date,cq_id),
	UNIQUE(cq_fetch_date,cq_id)
);
SELECT setup_tsdb_parent('tf_data');
CREATE TABLE IF NOT EXISTS "tf_resources" (
	"cq_id" uuid NOT NULL,
	"cq_meta" jsonb,
	"cq_fetch_date" timestamp without time zone NOT NULL,
	"tf_data_cq_id" uuid,
	"running_id" uuid,
	"module" text,
	"mode" text,
	"type" text,
	"name" text,
	"provider_path" text,
	"provider" text,
	CONSTRAINT tf_resources_pk PRIMARY KEY(cq_fetch_date,cq_id),
	UNIQUE(cq_fetch_date,cq_id)
);
CREATE INDEX ON tf_resources (cq_fetch_date, tf_data_cq_id);
SELECT setup_tsdb_child('tf_resources', 'tf_data_cq_id', 'tf_data', 'cq_id');
CREATE TABLE IF NOT EXISTS "tf_resource_instances" (
	"cq_id" uuid NOT NULL,
	"cq_meta" jsonb,
	"cq_fetch_date" timestamp without time zone NOT NULL,
	"tf_resource_cq_id" uuid,
	"resource_id" uuid,
	"instance_id" text,
	"schema_version" bigint,
	"attributes" jsonb,
	"dependencies" text[],
	"create_before_destroy" boolean,
	CONSTRAINT tf_resource_instances_pk PRIMARY KEY(cq_fetch_date,cq_id),
	UNIQUE(cq_fetch_date,cq_id)
);
CREATE INDEX ON tf_resource_instances (cq_fetch_date, tf_resource_cq_id);
SELECT setup_tsdb_child('tf_resource_instances', 'tf_resource_cq_id', 'tf_resources', 'cq_id');
